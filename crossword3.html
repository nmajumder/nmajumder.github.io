<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Nathan Majumder</title>
    <script type='text/javascript' language='javascript' src='CanvasInput-master/CanvasInput.js'></script>
    <script type='text/javascript' language='javascript' src='crossword-helper-funcs.js'></script>
    <link rel="stylesheet" href="css/normalize.css">
    <link href='http://fonts.googleapis.com/css?family=Josefin+Sans:400,600|Exo:400,600,600italic|Muli' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/mystyle.css">
    <link rel="stylesheet" href="css/responsive.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body id="crosswords">
    <header>
      <a href="index.html" id="logo">
        <h1>Nathan Majumder</h1>
      </a>
      <nav>
        <ul>
          <li><a href="index.html">Homepage</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="resume.html">Resume</a></li>
          <li><a href="projects.html">Projects</a></li> 
          <li><a href="crossword.html" class="selected">Crosswords</a></li>         
          <li><a href="abroad.html">Abroad</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </header>

    <div id="screenSizeMsg">
    	<h2>Sorry, crosswords are not supported on screens of this size.</h2>
    	<h3>Please try again on a larger device. Screen width must be greater than 680 pixels to use this feature, but the best experience is on devices of 1100 pixels or greater (any normal computer will work). Thanks!
    </div>
    <div id="crosswordWrapper">
        <div class="crossTitleBar">
    		<h2 class="crossTitle">Party Time</h2>
    		<h4 class="crossAuthor">By Nathan Majumder</h4>
        </div>
        <div class="checkDropdown">
          <button class="dropbtn">Check</button>
          <div class="dropdown-content">
            <a onclick="help(0,0)">Square</a>
            <a onclick="help(0,1)">Word</a>
            <a onclick="help(0,2)">Puzzle</a>
          </div>
        </div>
        <div class="revealDropdown">
          <button class="dropbtn">Reveal</button>
          <div class="dropdown-content">
            <a onclick="help(1,0)">Square</a>
            <a onclick="help(1,1)">Word</a>
            <a onclick="help(1,2)">Puzzle</a>
          </div>
        </div>
        <div class="timer">
            <button id="pauseBtn" onclick="pauseGame()"><img src="img/pause.png"></button>
            <span id="timeCounter"><label id="minutes">00</label>:<label id="seconds">00</label></span>
        </div>
        <button id="backbtn" onclick="crossBack()">Back</button>

    	<canvas id="canvas" width="600px" height="600px" style="border: 1px solid black;"></canvas>
    	<canvas id="midCanvas" width="600px" height="600px"></canvas>
    	<canvas id="topCanvas" width="600px" height="600px" style="border: 1px solid black;"></canvas>
    	<div id="clues">
    		<div id="across">
    			<h3 class="center">Across</h3>
    			<div class="clueScroll">
        			<ul class="numClues">
                        <li onclick="clueClicked(this,0)"><span class="bold">1.</span> Prefix with dent and pod</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">4.</span> * Porous aquatic organism</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">10.</span> Decide on, with "for"</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">13.</span> "___ Just Not That Into You"</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">14.</span> Most insignificant</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">15.</span> Displeased cry</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">16.</span> "Stargate SG-1" ascended beings</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">17.</span> "Sorry ___ Be the Hardest Word" (Elton John song)</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">18.</span> Area needing a cleanup</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">19.</span> * Expensive dress material</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">21.</span> Homer shout</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">22.</span> It was held by Rembrandt in his time</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">23.</span> Like some eggs</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">26.</span> Genesis location</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">27.</span> * Summer sandwich filler</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">29.</span> Conan cable chan.</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">32.</span> Tirade</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">33.</span> N.F.L. scores</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">34.</span> Easy ... Or a hint for the starred clues in this puzzle</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">37.</span> Bud, in Bordeaux</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">39.</span> Swivel</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">40.</span> C.N.N. offshoot</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">41.</span> * Anniversary of sorts</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">43.</span> This, in Tijuana</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">47.</span> Amistad passengers</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">48.</span> Monte Carlo Rally entry</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">51.</span> Outs partner</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">52.</span> * Type of lab</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">54.</span> Last in a mathematical sequence</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">55.</span> Loosened, as a grip</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">57.</span> Journey fragment</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">58.</span> 1988 Angelina Jolie title role</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">59.</span> Wife of Iago in Shakespeare</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">60.</span> One who gets paid to play, for short</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">61.</span> Western hemisphere treaty grp.</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">62.</span> * It may be Irish or black</li>
                        <li onclick="clueClicked(this,0)"><span class="bold">63.</span> I.D. thief's target</li>
        			</ul>
    			</div>
    		</div>
    		<div id="down">
    			<h3 class="center">Down</h3>
    			<div class="clueScroll">
        			<ul class="numClues">
                        <li onclick="clueClicked(this,1)"><span class="bold">1.</span> Jim who has been called the best athlete of the 20th century</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">2.</span> Double-check for errors, maybe</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">3.</span> Lazes about</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">4.</span> Extract metal from ore</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">5.</span> Pet annoyance?</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">6.</span> "It's either you ___"</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">7.</span> Type of tree house?</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">8.</span> Some govt. revenue</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">9.</span> Eisenhower's W.W.II domain</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">10.</span> Outdated</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">11.</span> Stoner</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">12.</span> Fisher-Price offering</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">17.</span> Roland Garros bit</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">20.</span> Twenty ounce serving, usually of 62-Across</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">21.</span> Southwest, e.g.: Abbr.</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">23.</span> Take out of the game</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">24.</span> Having seven as the highest digit</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">25.</span> Insta. flirting locale</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">27.</span> Marriage counselor filing for divorce, e.g.</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">28.</span> Half-___ (62-Across order)</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">30.</span> 1967 Physics Nobel Prize winner Hans</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">31.</span> Soviet Cold War missiles</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">34.</span> Amazon predators</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">35.</span> Timeline division</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">36.</span> Start to pray</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">37.</span> Crunch time goals?</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">38.</span> George Washington's men, at a time</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">42.</span> Features of sports bars, for short</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">44.</span> Tokens of victory in the past</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">45.</span> Fries' origins, informally</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">46.</span> Mount Hood setting</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">48.</span> Hart of "Chicago"</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">49.</span> Botanical suffix</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">50.</span> Atlantic catch</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">52.</span> Builder's alternative?</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">53.</span> 45 minutes at the World Cup</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">54.</span> Many a do-gooder grp.</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">55.</span> ___ center (community facility)</li>
                        <li onclick="clueClicked(this,1)"><span class="bold">56.</span> Rock subgenre</li>
        			</ul>
    			</div>
    		</div>
    	</div>
    </div>
    <div id="popup">
		<h2 id="popupmsg">Congratulations, you've successfully solved the puzzle!</h2>
		<button id="closebtn" onclick="closePopup()">Close</button>
	</div>

    <script type="text/javascript">

    var canvas = document.getElementById("canvas");
    var topcanvas = document.getElementById("topCanvas");
    var midcanvas = document.getElementById("midCanvas");

    // Get the canvas contexts
    var ctx = canvas.getContext("2d");
    var tctx = topcanvas.getContext("2d");
    var mctx = midcanvas.getContext("2d");


    // Get entire crossword wrapper
    var wrapper = document.getElementById("crosswordWrapper");
    var popup = document.getElementById("popup");
    var popupmsg = document.getElementById("popupmsg");
    var closebtn = document.getElementById("closebtn");

    var gameover = false;
    if (localStorage.getItem("gameover3")) {
        gameover = JSON.parse(localStorage.getItem("gameover3"));
    } else {
        localStorage.setItem('gameover3',JSON.stringify(gameover));
    }

    var minutesLabel = document.getElementById("minutes");
    var secondsLabel = document.getElementById("seconds");
    var totalSeconds = 0;
    if (localStorage.getItem("time3")) {
        totalSeconds = JSON.parse(localStorage.getItem("time3"));
        secondsLabel.innerHTML = pad(totalSeconds%60);
        minutesLabel.innerHTML = pad(parseInt(totalSeconds/60));
    }

    var noClick = false;
    if (!gameover) {
        var timer = setInterval(setTime, 1000);
        openPopup(3);
    }

    function setTime()
    {
        ++totalSeconds;
        secondsLabel.innerHTML = pad(totalSeconds%60);
        minutesLabel.innerHTML = pad(parseInt(totalSeconds/60));
        localStorage.setItem('time3',JSON.stringify(totalSeconds));
    }


    // initialize variables to be used throughout
    blanks = [];
    highlighted = [];

    const ARR_SIZE = 15;

    //
    // The Answer Key (must obviously be modified for every different puzzle)
    //
    var answers = new Array(ARR_SIZE);
    answers[0] =  ['T','R','I', 0 , 0 ,'S','P','O','N','G','E', 0 ,'O','P','T'];
    answers[1] =  ['H','E','S', 0 , 0 ,'M','E','R','E','S','T', 0 ,'B','O','O'];
    answers[2] =  ['O','R','I', 0 ,'S','E','E','M','S','T','O', 0 ,'S','T','Y'];
    answers[3] =  ['R','E','D','V','E','L','V','E','T', 0 , 0 ,'D','O','H', 0 ];
    answers[4] =  ['P','A','L','E','T','T','E', 0 , 0 ,'B','O','I','L','E','D'];
    answers[5] =  ['E','D','E','N', 0 , 0 , 0 ,'I','C','E','C','R','E','A','M'];
    answers[6] =  [ 0 , 0 , 0 ,'T','B','S', 0 ,'R','A','N','T', 0 ,'T','D','S'];
    answers[7] =  [ 0 , 0 ,'P','I','E','C','E','O','F','C','A','K','E', 0 , 0 ];
    answers[8] =  ['A','M','I', 0 ,'T','U','R','N', 0 ,'H','L','N', 0 , 0 , 0 ];
    answers[9] =  ['B','I','R','T','H','D','A','Y', 0 , 0 , 0 ,'E','S','T','O'];
    answers[10] = ['S','L','A','V','E','S', 0 , 0 ,'R','A','C','E','C','A','R'];
    answers[11] = [ 0 ,'I','N','S', 0 , 0 ,'C','H','O','C','O','L','A','T','E'];
    answers[12] = ['N','T','H', 0 ,'R','E','L','A','X','E','D', 0 ,'L','E','G'];
    answers[13] = ['G','I','A', 0 ,'E','M','I','L','I','A', 0 , 0 ,'P','R','O'];
    answers[14] = ['O','A','S', 0 ,'C','O','F','F','E','E', 0 , 0 ,'S','S','N'];

    var i = 1;
    while (answers[0][i-1] == 0) {
        i++;
    }
    var curx = i;
    var cury = 1;
    var dir = true; // true is across, false is down

    //console.log(answers);

    //
    // Draw the darker gray "highlighted" answer boxes (must be done custom by hand)
    //
    ctx.beginPath();

    ctx.rect(200,0,240,40);
    ctx.rect(0,120,360,40);
    ctx.rect(280,200,320,40);
    ctx.rect(80,280,440,40);
    ctx.rect(0,360,320,40);
    ctx.rect(240,440,360,40);
    ctx.rect(160,560,240,40);
    ctx.fillStyle = "#D3D3D3";
    ctx.fill();

    ctx.closePath();

    //
    // Draw the basic grid for the puzzle (good for all 15x15 puzzles)
    // 
    tctx.beginPath();

    tctx.moveTo(40,0); tctx.lineTo(40,600);
    tctx.moveTo(80,0); tctx.lineTo(80,600);
    tctx.moveTo(120,0); tctx.lineTo(120,600);
    tctx.moveTo(160,0); tctx.lineTo(160,600);
    tctx.moveTo(200,0); tctx.lineTo(200,600);
    tctx.moveTo(240,0); tctx.lineTo(240,600);
    tctx.moveTo(280,0); tctx.lineTo(280,600);
    tctx.moveTo(320,0); tctx.lineTo(320,600);
    tctx.moveTo(360,0); tctx.lineTo(360,600);
    tctx.moveTo(400,0); tctx.lineTo(400,600);
    tctx.moveTo(440,0); tctx.lineTo(440,600);
    tctx.moveTo(480,0); tctx.lineTo(480,600);
    tctx.moveTo(520,0); tctx.lineTo(520,600);
    tctx.moveTo(560,0); tctx.lineTo(560,600);

    tctx.moveTo(0,40); tctx.lineTo(600,40);
    tctx.moveTo(0,80); tctx.lineTo(600,80);
    tctx.moveTo(0,120); tctx.lineTo(600,120);
    tctx.moveTo(0,160); tctx.lineTo(600,160);
    tctx.moveTo(0,200); tctx.lineTo(600,200);
    tctx.moveTo(0,240); tctx.lineTo(600,240);
    tctx.moveTo(0,280); tctx.lineTo(600,280);
    tctx.moveTo(0,320); tctx.lineTo(600,320);
    tctx.moveTo(0,360); tctx.lineTo(600,360);
    tctx.moveTo(0,400); tctx.lineTo(600,400);
    tctx.moveTo(0,440); tctx.lineTo(600,440);
    tctx.moveTo(0,480); tctx.lineTo(600,480);
    tctx.moveTo(0,520); tctx.lineTo(600,520);
    tctx.moveTo(0,560); tctx.lineTo(600,560);
    tctx.stroke();
    tctx.closePath();


    //
    // draw the black spaces in the puzzle (must be done custom by hand)
    //
    tctx.beginPath();

    tctx.rect(120, 0, 40, 120);
    tctx.rect(160, 0, 40, 80);
    tctx.rect(440, 0, 40, 120);
    tctx.rect(360, 120, 80, 40);
    tctx.rect(560, 120, 40, 40);
    tctx.rect(280, 160, 80, 40);
    tctx.rect(160, 200, 120, 40);
    tctx.rect(0, 240, 120, 40);
    tctx.rect(240, 240, 40, 40);
    tctx.rect(440, 240, 40, 40);
    tctx.rect(0, 280, 80, 40);
    tctx.rect(520, 280, 80, 40);
    tctx.rect(120, 320, 40, 40);
    tctx.rect(320, 320, 40, 40);
    tctx.rect(480, 320, 120, 40);
    tctx.rect(320, 360, 120, 40);
    tctx.rect(240, 400, 80, 40);
    tctx.rect(0, 440, 40, 40);
    tctx.rect(160, 440, 80, 40);
    tctx.rect(120, 480, 40, 120);
    tctx.rect(440, 480, 40, 120);
    tctx.rect(400, 520, 40, 80);

    tctx.fillStyle = "#000000";
    tctx.fill();

    tctx.closePath();

    //
    // Draw the numbers in the corners (automated for all puzzles)
    //
    // Also store the space where each number is
    //
    var numbers = new Array(ARR_SIZE);

    ctx.font = "10px Arial";
    var ctr = 1;
    for (var i = 0; i < ARR_SIZE; i = i+1) {
      numbers[i] = new Array(ARR_SIZE);
      for (var j = 0; j < ARR_SIZE; j = j+1) {
        if (answers[i][j] == 0) {
          numbers[i][j] = 0;
          continue;
        }
        if (j == 0 || i == 0 || answers[i][j-1] == 0 || answers[i-1][j] == 0) {
          if (i == 0) {
            tctx.fillText(ctr,j*40 + 3, i*40 + 10);
          } else if (j == 0) {
            tctx.fillText(ctr,j*40 + 1, i*40 + 12);
          } else {
            tctx.fillText(ctr,j*40 + 3, i*40 + 12);
          }
          // store this number at correct space
          numbers[i][j] = ctr;

          ctr = ctr + 1;
        } else {
          numbers[i][j] = -1;
        }
      }
    }

    //console.log(numbers);

    //
    // initialize the array of blanks (black squares) and highlighted (darker gray words)
    // this should be the same for all puzzles as long as the same colors are used
    // i.e. #000000 --> (0,0,0,255) and #D3D3D3 --> (211,211,211,255)
    //
    for (var i = 20; i < 600; i = i + 40) {
      for (var j = 20; j < 600; j = j + 40) {
        tobj = tctx.getImageData(i,j,1,1);
        obj = ctx.getImageData(i,j,1,1);
        //console.log(i,j,obj.data);
        if (tobj.data[0] == 0 && tobj.data[1] == 0 && tobj.data[2] == 0 && tobj.data[3] == 255) {
          var tx = Math.ceil(i/40);
          var ty = Math.ceil(j/40);
          blanks.push([tx,ty]); 
        } else if (obj.data[0] == 211 && obj.data[1] == 211 && obj.data[2] == 211 && obj.data[3] == 255) {
          var tx = Math.ceil(i/40);
          var ty = Math.ceil(j/40);
          highlighted.push([tx,ty]);
        }
      }
    }

    // check to make sure blanks has right values
    /*for (i = 0; i < blanks.length; i++) {
      console.log(blanks[i][0], blanks[i][1]);
    }*/


    //
    // DEAL WITH THE CLUE-BOX INTERACTIONS HERE
    //

    // get clue lists as javascript variables
    var acrossList = document.getElementById("across").getElementsByTagName("li");
    var downList = document.getElementById("down").getElementsByTagName("li");

    var acrossClues = document.getElementById("across").getElementsByClassName("clueScroll")[0];
    var downClues = document.getElementById("down").getElementsByClassName("clueScroll")[0];

    var pcIndex = 0; // index in prev clue list
    var pcList = acrossList;
    var pcListInd = 0;
    //clueClicked(pcList[pcIndex],0);

    var extraKeyDown = false;


    // when selected words are implemented this should set the word given by
    //    the x,y coords (given in 1...15 each) and dir (true for horizontal)
    //    as the currently selected word, whatever we want that to mean
    //
    function setSelected(curx,cury,dir) {
    	// clear prev highlighted text boxes
    	for (var i = 0; i < ARR_SIZE; i++) {
    		for (var j = 0; j < ARR_SIZE; j++) {
    			if (inputBoxes[i][j] != 0) {
    				if (contains(highlighted,[i+1,j+1])) {
    					inputBoxes[i][j].backgroundColor('#D3D3D3');
    				} else {
    					inputBoxes[i][j].backgroundColor('#F0F0F0');
    				}
    			}
    		}
    	}

    	// clear prev highlighted rectangle
    	mctx.clearRect(0,0,midcanvas.width,midcanvas.height);

    	// paint new highlighted area
        if (dir) {
        	//console.log("GOING ACROSS");
            var i1 = curx;
            while (!contains(blanks,[i1,cury]) && i1 <= ARR_SIZE) {
              i1++;
            }
            var i2 = curx;
            while (!contains(blanks,[i2,cury]) && i2 >= 1) {
              i2--;
            }
            mctx.beginPath();
            mctx.rect(40*i2, 40*cury - 40, (i1-i2-1)*40, 40);
            mctx.fillStyle = 'rgba(230, 218, 0, 1.0)';
            mctx.fill();
            mctx.closePath();

            for (var i = i2; i < i1-1; i++) {
        		inputBoxes[i][cury-1].backgroundColor('rgba(230, 218, 0, 1.0)');
        	}
        } else {
        	//console.log("GOING DOWN");
        	var j1 = cury;
        	while (!contains(blanks,[curx,j1]) && j1 <= ARR_SIZE) {
        		j1++;
        	}
        	var j2 = cury;
        	while (!contains(blanks,[curx,j2]) && j2 >= 1) {
        		j2--;
        	}
        	mctx.beginPath();
        	mctx.rect(40*curx - 40, 40*j2,  40, (j1-j2-1)*40);
        	mctx.fillStyle = 'rgba(230, 218, 0, 1.0)';
        	mctx.fill();
        	mctx.closePath();

        	for (var j = j2; j < j1-1; j++) {
        		inputBoxes[curx-1][j].backgroundColor('rgba(230, 218, 0, 1.0)');
        	}
        }
        mctx.beginPath();
        mctx.rect((curx-1)*40, (cury-1)*40, 40, 40);
        mctx.fillStyle = 'rgba(180,170,0,1.0)';
        mctx.fill();
        mctx.closePath();

    	inputBoxes[curx-1][cury-1].backgroundColor('rgba(180,170,0,0.4)');

    	//
    	// highlight clue
    	//
    	
    	// clear prev highlighted clue
    	pcList[pcIndex].style.cssText = 'background-color: clear;';

    	var num = -1;
    	if (dir) {
    		var i = curx-1;
			while (i >= 0 && numbers[cury-1][i] != 0) {
				i = i-1;
			}
			num = numbers[cury-1][i+1];
    	} else {
    		var j = cury-1;
    		while (j >= 0 && numbers[j][curx-1] != 0) {
    			j = j-1;
    		}
    		num = numbers[j+1][curx-1];
    	}

    	//console.log("Number: " + num + " Across? " + dir);

    	pcList = acrossList;
        pcListInd = 0;
    	var clueScroll = acrossClues;
    	if (!dir) {
    		pcList = downList;
            pcListInd = 1;
    		clueScroll = downClues;
    	}
    	for (var i = 0; i < pcList.length; i = i+1) {
    		var obj = pcList[i];
    		var n = getClueNum(obj);
    		if (n == num) {
    			pcIndex = i;
    			obj.style.cssText = 'background-color: yellow;';
    			var topCoord = pcList[0].offsetTop;
    			clueScroll.scrollTop = obj.offsetTop - topCoord;
    			break;
    		}
    	}

        // DEALING WITH LOCAL STORAGE

        localStorage.setItem('curx3',JSON.stringify(curx));
        localStorage.setItem('cury3',JSON.stringify(cury));
        localStorage.setItem('direction3',JSON.stringify(dir));
        localStorage.setItem('inputVals3',JSON.stringify(inputVals));
        localStorage.setItem('fixedBoxes3',JSON.stringify(fixedBoxes));
        localStorage.setItem('pcListInd3',JSON.stringify(pcListInd));
        localStorage.setItem('pcIndex3',JSON.stringify(pcIndex));
        var perc = getCompletionPercent();
        localStorage.setItem('percent3',perc);

    }

    // 
    //	ON CLICK OF BOX, SET SELECTED BOX / CLUE
    //
    topcanvas.addEventListener('click', function(event) {
		var x = Math.ceil((event.pageX - canvas.offsetLeft)/40);
		var y = Math.ceil((event.pageY - canvas.offsetTop)/40);
        if (contains(blanks,[x,y])) {
            return;
        }
		if (curx == x && cury == y) {
			dir = !dir;
		} else {
			curx = x;
			cury = y;
		}
		setSelected(curx,cury,dir);
    });

    // 0 = blank space
    // 1 = normal
    // 2 = fixed (no marks, i.e. revealed)
    // 3 = checked but not right (not changed since checked)
    // 4 = normal after checked (changed since checked)
    // 5 = fixed (with checkmark, i.e. checked and correct)
    var fixedBoxes = new Array(ARR_SIZE);
    for (var i = 1; i <= ARR_SIZE; i = i+1) {
        fixedBoxes[i-1] = new Array(ARR_SIZE);
        for (var j = 1; j <= ARR_SIZE; j = j+1) {
            if (contains(blanks,[i,j])) {
                fixedBoxes[i-1][j-1] = 0;
            } else {
                fixedBoxes[i-1][j-1] = 1;
            }
        }
    }

    //console.log(fixedBoxes);

    //
    // Define the array of inputBoxes that will allow the user to fill letters
    //    into the squares in the puzzle -- stored as a 2D 15x15 array
    //
    var inputBoxes = new Array(ARR_SIZE);
    var inputVals = [];

    for (var i = 1; i <= ARR_SIZE; i = i+1) {
      inputBoxes[i-1] = new Array(ARR_SIZE);
      inputVals[i-1] = [];
      for (var j = 1; j <= ARR_SIZE; j = j+1) {
        inputVals[i-1][j-1] = "";
        if (contains(blanks,[i,j])) {
          inputBoxes[i-1][j-1] = 0;
        } else if (contains(highlighted,[i,j])) {
          inputBoxes[i-1][j-1] = new CanvasInput({
            canvas: topcanvas,
            fontSize: 26,
            readonly: true,
            x: 40*(i-1) + 12,
            y: 40*(j-1) + 16,
            fontFamily: 'Consolas',
            fontColor: '#212121',
            fontWeight: 'bold',
            width: 23,
            height: 23,
            padding: 0,
            borderWidth: 0,
            borderColor: '#000',
            borderRadius: 0,
            backgroundColor: '#D3D3D3',
            boxShadow: '0px 0px 0px #000',
            innerShadow: '0px 0px 0px rgba(0, 0, 0, 0.5)',
            placeHolder: ''
          });
        } else {
          inputBoxes[i-1][j-1] = new CanvasInput({
            canvas: topcanvas,
            fontSize: 26,
            readonly: true,
            x: 40*(i-1) + 12,
            y: 40*(j-1) + 16,
            fontFamily: 'Consolas',
            fontColor: '#000000',
            fontWeight: 'bold',
            width: 23,
            height: 23,
            padding: 0,
            borderWidth: 0,
            borderColor: '#000',
            borderRadius: 0,
            backgroundColor: '#F0F0F0',
            boxShadow: '0px 0px 0px #000',
            innerShadow: '0px 0px 0px rgba(0, 0, 0, 0.5)',
            placeHolder: ''
          });
        }
      }
    }

    if (window.localStorage) {
        //
        // Revert to saved state...
        //

        if (localStorage.getItem("curx3") != null && localStorage.getItem("cury3") != null
                && localStorage.getItem("direction3") != null) {
            curx = JSON.parse(localStorage.getItem("curx3"));
            cury = JSON.parse(localStorage.getItem("cury3"));
            dir = JSON.parse(localStorage.getItem("direction3"));                
        }

        if (localStorage.getItem("pcListInd3") != null && localStorage.getItem("pcIndex3") != null) {
            pcListInd = JSON.parse(localStorage.getItem("pcListInd3"));
            pcList = acrossList;
            if (pcListInd == 1) {
                pcList = downList;
            }
            if (localStorage.getItem("pcIndex3")) {
                pcIndex = localStorage.getItem("pcIndex3");
            }
        }

        if (localStorage.getItem("fixedBoxes3") != null && localStorage.getItem("inputVals3") != null) {
            fixedBoxes = JSON.parse(localStorage.getItem("fixedBoxes3"));
            inputVals = JSON.parse(localStorage.getItem("inputVals3"));
            
            for (var i = 1; i <= ARR_SIZE; i = i+1) {
                for (var j = 1; j <= ARR_SIZE; j = j+1) {
                    if (inputBoxes[i-1][j-1] == 0) {
                        continue;
                    }
                    inputBoxes[i-1][j-1].value(inputVals[i-1][j-1]);
                    if (fixedBoxes[i-1][j-1] == 2) {
                        inputBoxes[i-1][j-1].fontColor("#0044cc");
                    } else if (fixedBoxes[i-1][j-1] == 3) {
                        drawX(i,j);
                    } else if (fixedBoxes[i-1][j-1] == 4) {
                        drawTriangle(i,j);
                    } else if (fixedBoxes[i-1][j-1] == 5) {
                        drawCheckmark(i,j);
                    }
                }
            }
        }
    }

    setSelected(curx,cury,dir);

    //
    //  type = 0 (check) | 1 (reveal)
    //  quant = 0 (square) | 1 (word) | 2 (puzzle)
    //
    function help(type,quant) {
        if (gameover || noClick) {
            return;
        }
        switch(quant) {
            case 0:
                helpBox(type,curx,cury);
                break;
            case 1:
                if (dir) {
                    var i1 = curx, i2 = curx + 1;
                    while (!contains(blanks,[i1,cury]) && i1 > 0) {
                        helpBox(type,i1,cury);
                        i1--;
                    }
                    while (!contains(blanks,[i2,cury]) && i2 <= ARR_SIZE) {
                        helpBox(type,i2,cury);
                        i2++;
                    }

                } else {
                    var j1 = cury, j2 = cury + 1;
                    while (!contains(blanks,[curx,j1]) && j1 > 0) {
                        helpBox(type,curx,j1);
                        j1--;
                    }
                    while (!contains(blanks,[curx,j2]) && j2 <= ARR_SIZE) {
                        helpBox(type,curx,j2);
                        j2++;
                    }
                }
                break;
            case 2:
                for (var i = 0; i < ARR_SIZE; i++) {
                    for (var j = 0; j < ARR_SIZE; j++) {
                        if (inputBoxes[i][j] == 0) {
                            continue;
                        } else {
                            helpBox(type,i+1,j+1);
                        }
                    }
                }
                break;
            default:
                console.log("Error: Invalid input as variable 'quant'");
        }

        if (playerWins()) {
            delay(function() {
                openPopup(0);
            }, 10);
        }
        localStorage.setItem('fixedBoxes3',JSON.stringify(fixedBoxes));
        localStorage.setItem('inputVals3',JSON.stringify(inputVals));
        var perc = getCompletionPercent();
        localStorage.setItem('percent3',perc);
    }

    function playerWins() {
      for (var i = 0; i < ARR_SIZE; i = i+1) {
        for (var j = 0; j < ARR_SIZE; j = j+1) {
          if (inputBoxes[j][i] == 0) {
            continue;
          } else if (answers[i][j] != inputBoxes[j][i].value()) {
            return false;
          }
        }
      }
      gameover = true;
      localStorage.setItem('gameover3',JSON.stringify(gameover));
      return true;
    }

    </script>


    <footer>
        <a href="http://facebook.com/nathanmajumder"><img src="img/FB_logo.png" alt="Facebook logo"></a>
        <a href="https://github.com/nmajumder"><img src="img/GH_logo.png" alt="Github logo"></a>
        <a href="https://www.linkedin.com/pub/nathan-majumder/a6/29/b34?domainCountryName=&csrfToken=ajax%3A6249601243831115177"><img src="img/LI_logo.png" alt="LinkedIn logo"></a>
        <p>&copy; 2017 Nathan Majumder.</p>
      </footer>
    </div>
  </body>
</html>